module normalization
language QL
start symbol Start

test normalize no condition for question [[
	form f {
		q : "Question" boolean
	}
]] run normalize-all to [[
	form f {
		if(true) { q : "Question" boolean }
	}	
]]

test normalize no condition for computed [[
	form f {
		q : "Question" boolean(true)
	}
]] run normalize-all to [[
	form f {
		if(true) { q : "Question" boolean(true) }
	}	
]]

test normalize nested condition [[
	form f {
		q1 : "Question 1" boolean
		q2 : "Question 2" boolean
		if(q1) {
			if(q2) {
				q3 : "Question 3" boolean
			}
		}
	}
]] run normalize-all to [[
	form f {
		if(true) { q1 : "Question 1" boolean }
		if(true) { q2 : "Question 2" boolean }
		if(q1 && q2) { q3 : "Question 3" boolean }
	}	
]]

test normalize multiple questions in condition [[
	form f {
		q1 : "Question 1" boolean
		if(q1) {
			q2 : "Question 2" boolean
			q3 : "Question 3" boolean
		}
	}
]] run normalize-all to [[
	form f {
		if(true) { q1 : "Question 1" boolean }
		if(q1) { q2 : "Question 2" boolean }
		if(q1) { q3 : "Question 3" boolean }
	}	
]]
